#
# ltrace's Makefile.in
#

VERSION		:= 0.3.37

#OS		:= $(shell uname -s)
OS		:= @HOST_OS@

TOPDIR		= $(shell pwd)

prefix		= @prefix@
sysconfdir	= @sysconfdir@
bindir		= $(prefix)/bin
mandir		= @mandir@
docdir		= $(prefix)/share/doc/ltrace

CC		=	@CC@
CPPFLAGS	=	-iquote $(TOPDIR) -I$(TOPDIR)/sysdeps/$(OS) @CPPFLAGS@ @DEFS@ -DSYSCONFDIR=\"$(sysconfdir)\"
CFLAGS		=	-Wall @CFLAGS@
LDFLAGS		=	@LDFLAGS@
LIBS		=	@LIBS@

INSTALL		=	@INSTALL@
INSTALL_FILE	=	$(INSTALL) -p    -o root -g root  -m  644
INSTALL_PROGRAM	=	$(INSTALL) -p    -o root -g root  -m  755
INSTALL_SCRIPT	=	$(INSTALL) -p    -o root -g root  -m  755
INSTALL_DIR	=	$(INSTALL) -p -d -o root -g root  -m  755

OBJ	=	ltrace.o options.o elf.o output.o read_config_file.o	\
		execute_program.o wait_for_something.o process_event.o	\
		display_args.o breakpoints.o proc.o demangle.o dict.o \
		debug.o summary.o

DIST_DIR 	=	 $(shell basename `pwd`)


all:		ltrace

ltrace:		sysdeps/sysdep.o $(OBJ)
		$(CC) $(LDFLAGS) $^ $(LIBS) -o $@

sysdeps/sysdep.o: dummy
		$(MAKE) -C sysdeps/$(OS)

clean:
		$(MAKE) -C sysdeps/$(OS) clean
		$(RM) ltrace $(OBJ)
		$(RM) *~ *.bak a.out core KK

distclean:	clean
		$(RM) config.cache config.status config.log config.h Makefile configure.scan
		$(RM) -r autom4te.cache

realclean:	distclean
		$(RM) configure config.h.in

# This goes to the debian CVS server to export the latest version and put it in a tarball.
# It does NOT make a dist of your current directory
dist:		clean
		( rm -rf dist ; mkdir dist ; cd dist \
		cvs -d:pserver:anonymous@cvs.alioth.debian.org:/cvsroot/ltrace login; \
		cvs -d:pserver:anonymous@cvs.alioth.debian.org:/cvsroot/ltrace export -d ltrace-$(VERSION) -D tomorrow ltrace; \
		cd ltrace-$(VERSION); \
		rm -rf debian; \
		./autogen.sh; \
		rm autogen.sh; \
		cd ..; \
		tar cfz ltrace-$(VERSION).tar.gz ./ltrace-$(VERSION); \
		mv ltrace-$(VERSION).tar.gz ../; \
		cd ..; \
		rm -rf dist; \
		echo "ALL DONE!" )

install:	ltrace
		$(INSTALL_DIR) $(DESTDIR)$(bindir) $(DESTDIR)$(docdir) $(DESTDIR)$(mandir)/man1
		$(INSTALL_DIR) $(DESTDIR)$(sysconfdir)
		$(INSTALL_PROGRAM) ltrace $(DESTDIR)$(bindir)
		$(INSTALL_FILE) etc/ltrace.conf $(DESTDIR)$(sysconfdir)
		$(INSTALL_FILE) COPYING README TODO BUGS ChangeLog $(DESTDIR)$(docdir)
		$(INSTALL_FILE) ltrace.1 $(DESTDIR)$(mandir)/man1

dummy:

TAGS:	
	find -name '*.c' -o -name '*.h' | xargs etags -a

.PHONY:		all clean distclean dist install dummy TAGS

.EXPORT_ALL_VARIABLES:
